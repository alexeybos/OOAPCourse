В принципе заход верный, но пока явно не хватает уверенности в реализации.
Опять недокрутил с дженериками, ну и в том числе отсюда лишняя реализация в Any.